{% extends "bootstrapbase.html" %}
{% block title %} ColDoc — {{ coldoc.nickname }}{% endblock %}
{% block extrahead %}<script src="/static/ColDoc/js/dyna.js"></script>{% endblock %}
{% block content %}


<h1>{% if coldoc.title %} {{coldoc.title}} {% else %}
ColDoc  — {{ coldoc.nickname }} {% endif %}</h1>

First published {{ coldoc.publication_time }}
{% if coldoc.authors %}
<h2>Authors</h2>
<p> {{ coldoc.authors|escape|linebreaks }}</p>
{% endif %}
{% if coldoc.abstract %}
<h2>Abstract</h2>
<p>{{ coldoc.abstract }}</p>
{% endif %}

<br>

<a href="{% url 'ColDoc:html' NICK=coldoc.nickname %}" class="btn {{ whole_button_class }} btn-sm">
 View whole document
</a>

<a href="{% url 'ColDoc:pdf' NICK=coldoc.nickname %}" class="btn {{ whole_button_class }} btn-sm">
 View whole document, as PDF
</a>

<a href="{% url 'UUID:index' NICK=coldoc.nickname UUID=coldoc.root_uuid %}" class="btn btn-outline-primary btn-sm">
 Navigate document tree
</a>

<br>

{% if user.is_editor %}
<a href="{% url 'ColDoc:latex' NICK=coldoc.nickname %}?type=anon"
 class="btn btn-outline-primary btn-sm" data-toggle="tooltip" title="In this HTML and PDF private material is omitted.">
 Compile public HTML and PDF. 
</a>
<a href="{% url 'ColDoc:latex' NICK=coldoc.nickname  %}?type=main" class="btn btn-outline-primary btn-sm"
 data-toggle="tooltip" title="This HTML and PDF are visible only to editors; all material is visible.">
 Compile private HTML and PDF.
</a>
{% endif %}

<!-- <a href="{{ htmlurl }}?download"><button type="button" class="btn btn-outline-primary btn-sm">Download</button></a>    <br> -->

<!-- <h2>View</h2> <iframe src="{{ htmlurl }}"   width="100%"   height="640px">(View should be displayed here)</iframe> -->


{% if user.is_editor %}
<h2>Document checks</h2>
<div class="border border-info mt-2">
<div id='id_check_tree'>......</div>
<button   type="button" class="btn btn-outline-primary btn-sm" id="id_button_check_tree" onClick="AJAXcheck_tree('{{ check_tree_url }}');">
  check tree
</button>
</div>
<script>window.addEventListener('ready', AJAXcheck_tree('{{ check_tree_url }}') );</script>
{% endif %} <!-- if editor-->


{% if user.is_editor %}
{% if latex_error_logs %}
    <div class="border border-info mt-2">
       There were LaTeX errors while compiling the main document
       <ul>
        {% for val,link in latex_error_logs %}
                <li>{% if link  %}  <a href="{{ link }}">    {% endif %}
                {{ val }}
                {% if link %}  </a>   {% endif %}
         {% endfor %}
        </ul>
     </div>
{% endif %}
{% endif %} <!-- if editor-->

{% if user.is_editor %}
{% if failedblobs %}
<h2>Failed blobs in tree</h2>
<ul>
 {% for val ,link in failedblobs %}
 <li>{% if link  %}  <a href="{{ link }}">    {% endif %}
                {{ val }}
                {% if link %}  </a>   {% endif %}
{% endfor %}
</ul>
{% endif %}
{% endif %} <!-- if editor-->


{% if perms.ColDocApp.view_dcoldoc %}
<h2>Settings</h2>
<div class="border border-info mt-2">
     {% if perms.ColDocApp.change_dcoldoc %}
     <form action="{% url 'ColDoc:postcoldocedit' NICK=NICK %}" id="{{ coldocform.htmlid }}" method="post" class="w-100">
     {% csrf_token %}{{ coldocform.non_field_errors }}
     {% endif %}
<table class="w-100">{{ coldocform }}</table>
{% if perms.ColDocApp.change_dcoldoc %} <input type="submit" class="btn btn-primary" value="Submit">   </form> {% else %}
   <div class="alert alert-warning" role="alert">No permission to change data.</div>{% endif %}
</div>
{% endif %} <!--perms.ColDocApp.view_dcoldoc-->

{% if user.is_staff %}
<a href="/admin/ColDocApp/dcoldoc/{{ coldoc.nickname }}/change/" class="btn btn-outline-primary btn-sm">
  edit settings in admin form
</a>
{% endif %}


{% endblock %}
